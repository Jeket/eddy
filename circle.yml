## Customize the test machine
machine:

  ## Version of python to use
  python:
    version:
      3.5.0

  ## Install Qt5
  pre:
    - sudo apt-add-repository ppa:beineri/opt-qt551 -y
    - sudo apt-get update
    - sudo apt-get install qt-latest
    - echo "source /opt/qt55/bin/qt55-env.sh" >> ~/.circlerc


## Customize python dependencies
dependencies:

  # Install SIP and PyQt5
  pre:
    # Prepare the build environment
    - sudo mkdir -p /builds && sudo chmod a+rw /builds
    - sudo mkdir -p /downloads && sudo chmod a+rw /downloads
    # Downloads
    - curl -L -o /downloads/sip.tar.gz http://sourceforge.net/projects/pyqt/files/sip/sip-4.17/sip-4.17.tar.gz
    - curl -L -o /downloads/pyqt.tar.gz http://skylink.dl.sourceforge.net/project/pyqt/PyQt5/PyQt-5.5.1/PyQt-gpl-5.5.1.tar.gz
    # Extract archives
    - tar xzf /downloads/sip.tar.gz -C /builds --keep-newer-files
    - tar xzf /downloads/pyqt.tar.gz -C /builds --keep-newer-files
    # Build SIP
    - cd /builds/sip-4.17 && python configure.py
    - cd /builds/sip-4.17 && sudo make && sudo make install
    # Build PyQt5
    - cd /builds/PyQt-gpl-5.5.1 && python configure.py --confirm-license --no-designer-plugin -e QtCore -e QtGui -e QtWidgets -e QtPrintSupport -e QtXml -e QtTest
    - cd /builds/PyQt-gpl-5.5.1 && sudo make && sudo make install

  ## Install PIP packages
  post:
    - pip install -U pip
    - pip install -r test-requirements.txt


## Customize test suite
test:

  ## Run automates tests using nose
  override:
    - nosetests --where=tests --verbosity=3
